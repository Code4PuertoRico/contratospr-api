{% extends "base.html" %}

{% load millify %}
{% load humanize %}

{% block content %}
<div class="flex self-start justify-center min-h-screen">
  <div class="w-full max-w-md mb-4">
    <h1 class="mb-2">
      <a class="no-underline text-grey-darkest hover:text-black" href="{% url 'index' %}">Contratos de Puerto Rico</a>
    </h1>
    {% include "contracts/partials/search.html" with query=query %}

    <div class="mt-2">
      <p>Se encontraron <span class="font-bold text-grey-darkest">{{ contracts.paginator.count|intcomma }}</span> contratos.</p>
    </div>

    <div class="mt-2">
      {% for contract in contracts %}
        <div class="mb-4 py-4 border-b border-grey-light">
          <p class="text-black font-bold text-xl">
            <a class="no-underline font-bold text-grey-darker hover:text-black" href="{% url 'contract' contract.id %}">
              ${{ contract.amount_to_pay|millify }} - <span class="text-grey">{{ contract }}</span>
            </a>
          </p>
          <p class="text-grey-darker"><a class="no-underline text-grey-darker hover:text-black" href="{% url 'entity' contract.entity_id %}">{{ contract.entity }}</a></p>
          <p class="text-grey-darker">Otorgado: {{ contract.date_of_grant|date }}</p>
        </div>
      {% endfor %}

      {% if contracts %}
        <div class="text-center">
          {% if contracts.has_previous %}
            <a class="no-underline text-blue hover:text-blue-darker mr-2" href="?q={{ query }}&page={{ contracts.previous_page_number }}">&larr; previous</a>
          {% endif %}

          {% for n in contracts.paginator.page_range %}
            {% if contracts.number == n %}
              <span class="font-bold text-blue-darker mr-2">{{ n }}</span>
            {% elif n > contracts.number|add:'-3' and n < contracts.number|add:'3' %}
              <a class="no-underline text-blue hover:text-blue-darker mr-2" href="?q={{ query }}&page={{ n }}">{{ n }}</a>
            {% endif %}
          {% endfor %}

          {% if contracts.has_next %}
            <a class="no-underline text-blue hover:text-blue-darker" href="?q={{ query }}&page={{ contracts.next_page_number }}">next &rarr;</a>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock content %}
